<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>移动端拖拽事件 | QuJun</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.cc28e6a4.css" as="style"><link rel="preload" href="/assets/js/app.1f96c4ff.js" as="script"><link rel="preload" href="/assets/js/10.9e31c3c2.js" as="script"><link rel="prefetch" href="/assets/js/11.7dab10e1.js"><link rel="prefetch" href="/assets/js/12.7513099c.js"><link rel="prefetch" href="/assets/js/13.68842f3d.js"><link rel="prefetch" href="/assets/js/14.8d9456ac.js"><link rel="prefetch" href="/assets/js/15.99b97b80.js"><link rel="prefetch" href="/assets/js/16.67339f5e.js"><link rel="prefetch" href="/assets/js/17.695e99c1.js"><link rel="prefetch" href="/assets/js/18.7c8ebc6c.js"><link rel="prefetch" href="/assets/js/19.de48b276.js"><link rel="prefetch" href="/assets/js/2.186c8e36.js"><link rel="prefetch" href="/assets/js/20.e5cad022.js"><link rel="prefetch" href="/assets/js/21.136f3082.js"><link rel="prefetch" href="/assets/js/22.5933badb.js"><link rel="prefetch" href="/assets/js/23.4815e585.js"><link rel="prefetch" href="/assets/js/24.e4c0f1e6.js"><link rel="prefetch" href="/assets/js/25.b4f4560f.js"><link rel="prefetch" href="/assets/js/3.4bdd8bd9.js"><link rel="prefetch" href="/assets/js/4.6cdac276.js"><link rel="prefetch" href="/assets/js/5.29c35377.js"><link rel="prefetch" href="/assets/js/6.082f5270.js"><link rel="prefetch" href="/assets/js/7.3183414e.js"><link rel="prefetch" href="/assets/js/8.e6589234.js"><link rel="prefetch" href="/assets/js/9.24cff399.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cc28e6a4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">QuJun</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Javascript/" class="nav-link router-link-active">Javascript</a></div><div class="nav-item"><a href="/others/" class="nav-link">杂记</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Javascript/" class="nav-link router-link-active">Javascript</a></div><div class="nav-item"><a href="/others/" class="nav-link">杂记</a></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content"><p>这次是一次需求引起的反思。现在 MVVM 框架越来越流行，并且大多数都已经实现了双向绑定，使得人们无需考虑如何去获取 DOM 元素，给他们增加样式，实现各种各样的动画等等。很多动画库都实现了绚丽的效果并且无需来考虑兼容性。但是 JS 变得越来越便利的时候，我们好像忘记了一些基本技能，比如如何用原生实现各种动画，以及拖拽。

这次我们的需求是需要实现一个卡列表拖拽转账的功能。卡列表数量不定，高度不定。具体交互是 鼠标长按某一张卡，然后拖到另一张卡上面去进行转账。中间不能有卡顿，并且卡列表太长时，卡片滑到底部或顶部，能够自动触发滚动事件。所以具体要实现以下几点：</p> <ul><li>要识别拖动元素和滚动屏幕两种效果，具体是用户长按某一张卡就可以拖动，否则就是直接滚动屏幕。</li> <li>长按拖动实际是复制该元素的一个副本，副本完成拖动效果，实际的元素位置不变。</li> <li>拖动的时候要识别是否接近顶部或者底部，这个时候就要触发滚动条来使屏幕滚动。</li> <li>识别拖动的目标位置，当拖动完成时能获取拖动结束时目标元素的信息。</li></ul> <p>刚开始时找了好久的源码、插件什么的，但是都不是很满意，因为有些插件定制的功能不用不到，改动的话又需要花费大量时间。所以接下来的话还是自己手动实现把！</p> <p>前期做了一些准备工作（其实就是踩那些插件的坑），定了下面的方案，首先不能用 H5 的<code>Drag</code>事件 和 <code>mouse</code>，因为它不支持移动端,Drag 是H5的新特性 在低版本浏览器的兼容性也不好，所以,综合考虑 采用了 <code>touch</code> 系列的事件。</p> <p>代码是次要的，主要是来说说思路。</p> <blockquote><p>识别长按和拖动</p></blockquote> <p>这个主要是通过给元素设置定位来实现的。我们知道移动端touch有三个事件 <code>touchstart``touchmove</code> <code>touchend</code> 如果是长按会把拖拽元素的定位设置成<code>absolute</code>
根据计算的定位可以来进行拖动，如果元素的<code>position:reletive</code>,则只会触发滚动条。具体的实现方法是在 touchstart 事件中 加个 <code>setTimeout</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//部分代码</span>
ele<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">!==</span> <span class="token string">'absolute'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       longTouch <span class="token operator">=</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'absolute'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

ele<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchmove'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>longTouch<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----> <div data-v-cb248452><div class="excerpt" data-v-cb248452></div></div></div></div>
    <script src="/assets/js/app.1f96c4ff.js" defer></script><script src="/assets/js/10.9e31c3c2.js" defer></script>
  </body>
</html>
